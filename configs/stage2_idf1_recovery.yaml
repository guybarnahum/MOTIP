# configs/stage2_idf1_recovery.yaml

# ------------------------------------------------------------------------
# STAGE 2: UNIVERSAL REFINEMENT (IDF1 RECOVERY)
# Goal: Fix ID switches by training on longer clips with larger data volume.
# ------------------------------------------------------------------------

# Base Architecture
SUPER_CONFIG_PATH: ./configs/r50_deformable_detr_motip_dancetrack.yaml
root_path: "."

# 2 Classes: Person (1) + Vehicle (2)
NUM_CLASSES: 2

# ------------------------------------------------------------------------
# Weights: LOAD STAGE 1
# ------------------------------------------------------------------------
# ⚠️ Ensure this path matches your best checkpoint from the run you just finished.
# Timstamp: 20260114_195715
DETR_PRETRAIN: "pretrains/motip_stage1.pth"

# We reset the optimizer to allow a fresh "refinement" phase
RESUME_OPTIMIZER: False
RESUME_SCHEDULER: False

# ------------------------------------------------------------------------
# Training Strategy (Refinement)
# ------------------------------------------------------------------------
EPOCHS: 10
LR: 1.0e-5          # LOWER LR: We are polishing, not learning from scratch.
LR_DROP: 7          # Drop late to settle the weights
LR_BACKBONE: 1.0e-6 # Very low backbone LR to preserve feature extraction
LR_WARMUP_EPOCHS: 0

# ------------------------------------------------------------------------
# Sampling Strategy (The IDF1 Fix)
# ------------------------------------------------------------------------
# We increase clip length to 5, 6, and 7 frames.
# This forces the model to track identities over longer durations, 
# directly punishing ID switches in the loss function.
sampler_lengths: [5, 6, 7]
sample_intervals: [1, 2, 3]

# ------------------------------------------------------------------------
# Hardware Safety (A10G / 24GB VRAM)
# ------------------------------------------------------------------------
BATCH_SIZE: 1
ACCUMULATE_STEPS: 4
NUM_WORKERS: 4

MEMORY_EFFICIENT: True
USE_DECODER_CHECKPOINT: True

# Resolution Safety
# Since we increased clip length (Time), we must be careful with Resolution (Space).
# Keeping max size at 1000 ensures we don't OOM with 7-frame clips.
AUG_MAX_SIZE: 1000
AUG_RESIZE_SCALES: [480, 512, 544, 576, 608, 640]
AUG_RANDOM_RESIZE: [400, 500, 600]

OUTPUT_DIR: null

# ------------------------------------------------------------------------
# Validation
# ------------------------------------------------------------------------
val_config:
  GT_FOLDER: "./datasets/DanceTrack/val"
  SEQMAP_FILE: "./datasets/DanceTrack/val_seqmap.txt"
  SPLIT_TO_EVAL: "val"
  CLASSES_TO_EVAL: ['pedestrian', 'car'] 
  CLASS_NAME_TO_ID: 
    pedestrian: 1
    car: 2
